ÿ
UD:\REGame\Assets\UnmaskForUGUI-main\UnmaskForUGUI-main\Scripts\UnmaskRaycastFilter.cs
	namespace 	
Coffee
 
. 
UIExtensions 
{ 
[		 
AddComponentMenu		 
(		 
$str		 5
,		5 6
$num		7 8
)		8 9
]		9 :
public

 

class

 
UnmaskRaycastFilter

 $
:

% &
MonoBehaviour

' 4
,

4 5 
ICanvasRaycastFilter

6 J
{ 
[ 	
Tooltip	 
( 
$str Z
)Z [
][ \
[ 	
SerializeField	 
] 
private  
Unmask! '
m_TargetUnmask( 6
;6 7
public 
Unmask 
targetUnmask "
{# $
get% (
{) *
return+ 1
m_TargetUnmask2 @
;@ A
}B C
setD G
{H I
m_TargetUnmaskJ X
=Y Z
value[ `
;` a
}b c
}d e
public!! 
bool!! "
IsRaycastLocationValid!! *
(!!* +
Vector2!!+ 2
sp!!3 5
,!!5 6
Camera!!7 =
eventCamera!!> I
)!!I J
{"" 	
if$$ 
($$ 
!$$ 
isActiveAndEnabled$$ #
||$$$ &
!$$' (
m_TargetUnmask$$( 6
||$$7 9
!$$: ;
m_TargetUnmask$$; I
.$$I J
isActiveAndEnabled$$J \
)$$\ ]
{%% 
return&& 
true&& 
;&& 
}'' 
if** 
(** 
eventCamera** 
)** 
{++ 
return,, 
!,,  
RectTransformUtility,, ,
.,,, -(
RectangleContainsScreenPoint,,- I
(,,I J
(,,J K
m_TargetUnmask,,K Y
.,,Y Z
	transform,,Z c
as,,d f
RectTransform,,g t
),,t u
,,,u v
sp,,w y
,,,y z
eventCamera	,,{ Ü
)
,,Ü á
;
,,á à
}-- 
else.. 
{// 
return00 
!00  
RectTransformUtility00 ,
.00, -(
RectangleContainsScreenPoint00- I
(00I J
(00J K
m_TargetUnmask00K Y
.00Y Z
	transform00Z c
as00d f
RectTransform00g t
)00t u
,00u v
sp00w y
)00y z
;00z {
}11 
}22 	
void<< 
OnEnable<< 
(<< 
)<< 
{== 	
}>> 	
}?? 
}@@ ˚Ç
HD:\REGame\Assets\UnmaskForUGUI-main\UnmaskForUGUI-main\Scripts\Unmask.cs
	namespace 	
Coffee
 
. 
UIExtensions 
{ 
[ 
ExecuteInEditMode 
] 
[ 
AddComponentMenu 
( 
$str (
,( )
$num* +
)+ ,
], -
public 

class 
Unmask 
: 
MonoBehaviour '
,' (
IMaterialModifier) :
{ 
private 
static 
readonly 
Vector2  '
s_Center( 0
=1 2
new3 6
Vector27 >
(> ?
$num? C
,C D
$numE I
)I J
;J K
[ 	
Tooltip	 
( 
$str ?
)? @
]@ A
[ 	
SerializeField	 
] 
private  
RectTransform! .
m_FitTarget/ :
;: ;
[ 	
Tooltip	 
( 
$str Y
)Y Z
]Z [
[ 	
SerializeField	 
] 
private  
bool! %
m_FitOnLateUpdate& 7
;7 8
[ 	
Tooltip	 
( 
$str 4
)4 5
]5 6
[   	
SerializeField  	 
]   
private    
bool  ! %
m_OnlyForChildren  & 7
=  8 9
false  : ?
;  ? @
["" 	
Tooltip""	 
("" 
$str"" S
)""S T
]""T U
[## 	
SerializeField##	 
]## 
private##  
bool##! %
m_ShowUnmaskGraphic##& 9
=##: ;
false##< A
;##A B
[%% 	
Tooltip%%	 
(%% 
$str%% "
)%%" #
]%%# $
[&& 	
Range&&	 
(&& 
$num&& 
,&& 
$num&& 
)&& 
]&& 
['' 	
SerializeField''	 
]'' 
private''  
float''! &
m_EdgeSmoothing''' 6
=''7 8
$num''9 ;
;''; <
public11 
MaskableGraphic11 
graphic11 &
{11' (
get11) ,
{11- .
return11/ 5
_graphic116 >
??11? A
(11B C
_graphic11C K
=11L M
GetComponent11N Z
<11Z [
MaskableGraphic11[ j
>11j k
(11k l
)11l m
)11m n
;11n o
}11p q
}11r s
public66 
RectTransform66 
	fitTarget66 &
{77 	
get88 
{88 
return88 
m_FitTarget88 $
;88$ %
}88& '
set99 
{:: 
m_FitTarget;; 
=;; 
value;; #
;;;# $
FitTo<< 
(<< 
m_FitTarget<< !
)<<! "
;<<" #
}== 
}>> 	
publicCC 
boolCC 
fitOnLateUpdateCC #
{CC$ %
getCC& )
{CC* +
returnCC, 2
m_FitOnLateUpdateCC3 D
;CCD E
}CCF G
setCCH K
{CCL M
m_FitOnLateUpdateCCN _
=CC` a
valueCCb g
;CCg h
}CCi j
}CCk l
publicHH 
boolHH 
showUnmaskGraphicHH %
{II 	
getJJ 
{JJ 
returnJJ 
m_ShowUnmaskGraphicJJ ,
;JJ, -
}JJ. /
setKK 
{LL 
m_ShowUnmaskGraphicMM #
=MM$ %
valueMM& +
;MM+ ,
SetDirtyNN 
(NN 
)NN 
;NN 
}OO 
}PP 	
publicUU 
boolUU 
onlyForChildrenUU #
{VV 	
getWW 
{WW 
returnWW 
m_OnlyForChildrenWW *
;WW* +
}WW, -
setXX 
{YY 
m_OnlyForChildrenZZ !
=ZZ" #
valueZZ$ )
;ZZ) *
SetDirty[[ 
([[ 
)[[ 
;[[ 
}\\ 
}]] 	
publicbb 
floatbb 
edgeSmoothingbb "
{cc 	
getdd 
{dd 
returndd 
m_EdgeSmoothingdd (
;dd( )
}dd* +
setee 
{ee 
m_EdgeSmoothingee !
=ee" #
valueee$ )
;ee) *
}ee+ ,
}ff 	
publicmm 
Materialmm 
GetModifiedMaterialmm +
(mm+ ,
Materialmm, 4
baseMaterialmm5 A
)mmA B
{nn 	
ifoo 
(oo 
!oo 
isActiveAndEnabledoo #
)oo# $
{pp 
returnqq 
baseMaterialqq #
;qq# $
}rr 
	Transformtt 
	stopAftertt 
=tt  !
MaskUtilitiestt" /
.tt/ 0&
FindRootSortOverrideCanvastt0 J
(ttJ K
	transformttK T
)ttT U
;ttU V
varuu 
stencilDepthuu 
=uu 
MaskUtilitiesuu ,
.uu, -
GetStencilDepthuu- <
(uu< =
	transformuu= F
,uuF G
	stopAfteruuH Q
)uuQ R
;uuR S
varvv 
desiredStencilBitvv !
=vv" #
$numvv$ %
<<vv& (
stencilDepthvv) 5
;vv5 6
StencilMaterialxx 
.xx 
Removexx "
(xx" #
_unmaskMaterialxx# 2
)xx2 3
;xx3 4
_unmaskMaterialyy 
=yy 
StencilMaterialyy -
.yy- .
Addyy. 1
(yy1 2
baseMaterialyy2 >
,yy> ?
desiredStencilBityy@ Q
-yyR S
$numyyT U
,yyU V
	StencilOpyyW `
.yy` a
Invertyya g
,yyg h
CompareFunctionyyi x
.yyx y
Equalyyy ~
,yy~ !
m_ShowUnmaskGraphic
yyÄ ì
?
yyî ï
ColorWriteMask
yyñ §
.
yy§ •
All
yy• ®
:
yy© ™
(
yy´ ¨
ColorWriteMask
yy¨ ∫
)
yy∫ ª
$num
yyª º
,
yyº Ω
desiredStencilBit
yyæ œ
-
yy– —
$num
yy“ ”
,
yy” ‘
(
yy’ ÷
$num
yy÷ ◊
<<
yyÿ ⁄
$num
yy€ ‹
)
yy‹ ›
-
yyﬁ ﬂ
$num
yy‡ ·
)
yy· ‚
;
yy‚ „
var|| 
canvasRenderer|| 
=||  
graphic||! (
.||( )
canvasRenderer||) 7
;||7 8
if}} 
(}} 
m_OnlyForChildren}} !
)}}! "
{~~ 
StencilMaterial 
.  
Remove  &
(& '!
_revertUnmaskMaterial' <
)< =
;= >#
_revertUnmaskMaterial
ÄÄ %
=
ÄÄ& '
StencilMaterial
ÄÄ( 7
.
ÄÄ7 8
Add
ÄÄ8 ;
(
ÄÄ; <
baseMaterial
ÄÄ< H
,
ÄÄH I
(
ÄÄJ K
$num
ÄÄK L
<<
ÄÄM O
$num
ÄÄP Q
)
ÄÄQ R
,
ÄÄR S
	StencilOp
ÄÄT ]
.
ÄÄ] ^
Invert
ÄÄ^ d
,
ÄÄd e
CompareFunction
ÄÄf u
.
ÄÄu v
Equal
ÄÄv {
,
ÄÄ{ |
(
ÄÄ} ~
ColorWriteMaskÄÄ~ å
)ÄÄå ç
$numÄÄç é
,ÄÄé è
(ÄÄê ë
$numÄÄë í
<<ÄÄì ï
$numÄÄñ ó
)ÄÄó ò
,ÄÄò ô
(ÄÄö õ
$numÄÄõ ú
<<ÄÄù ü
$numÄÄ† °
)ÄÄ° ¢
-ÄÄ£ §
$numÄÄ• ¶
)ÄÄ¶ ß
;ÄÄß ®
canvasRenderer
ÅÅ 
.
ÅÅ 
hasPopInstruction
ÅÅ 0
=
ÅÅ1 2
true
ÅÅ3 7
;
ÅÅ7 8
canvasRenderer
ÇÇ 
.
ÇÇ 
popMaterialCount
ÇÇ /
=
ÇÇ0 1
$num
ÇÇ2 3
;
ÇÇ3 4
canvasRenderer
ÉÉ 
.
ÉÉ 
SetPopMaterial
ÉÉ -
(
ÉÉ- .#
_revertUnmaskMaterial
ÉÉ. C
,
ÉÉC D
$num
ÉÉE F
)
ÉÉF G
;
ÉÉG H
}
ÑÑ 
else
ÖÖ 
{
ÜÜ 
canvasRenderer
áá 
.
áá 
hasPopInstruction
áá 0
=
áá1 2
false
áá3 8
;
áá8 9
canvasRenderer
àà 
.
àà 
popMaterialCount
àà /
=
àà0 1
$num
àà2 3
;
àà3 4
}
ââ 
return
ãã 
_unmaskMaterial
ãã "
;
ãã" #
}
åå 	
public
íí 
void
íí 
FitTo
íí 
(
íí 
RectTransform
íí '
target
íí( .
)
íí. /
{
ìì 	
var
îî 
rt
îî 
=
îî 
	transform
îî 
as
îî !
RectTransform
îî" /
;
îî/ 0
rt
ññ 
.
ññ 
pivot
ññ 
=
ññ 
target
ññ 
.
ññ 
pivot
ññ #
;
ññ# $
rt
óó 
.
óó 
position
óó 
=
óó 
target
óó  
.
óó  !
position
óó! )
;
óó) *
rt
òò 
.
òò 
rotation
òò 
=
òò 
target
òò  
.
òò  !
rotation
òò! )
;
òò) *
var
öö 
s1
öö 
=
öö 
target
öö 
.
öö 

lossyScale
öö &
;
öö& '
var
õõ 
s2
õõ 
=
õõ 
rt
õõ 
.
õõ 
parent
õõ 
.
õõ 

lossyScale
õõ )
;
õõ) *
rt
úú 
.
úú 

localScale
úú 
=
úú 
new
úú 
Vector3
úú  '
(
úú' (
s1
úú( *
.
úú* +
x
úú+ ,
/
úú- .
s2
úú/ 1
.
úú1 2
x
úú2 3
,
úú3 4
s1
úú5 7
.
úú7 8
y
úú8 9
/
úú: ;
s2
úú< >
.
úú> ?
y
úú? @
,
úú@ A
s1
úúB D
.
úúD E
z
úúE F
/
úúG H
s2
úúI K
.
úúK L
z
úúL M
)
úúM N
;
úúN O
rt
ùù 
.
ùù 
	sizeDelta
ùù 
=
ùù 
target
ùù !
.
ùù! "
rect
ùù" &
.
ùù& '
size
ùù' +
;
ùù+ ,
rt
ûû 
.
ûû 
	anchorMax
ûû 
=
ûû 
rt
ûû 
.
ûû 
	anchorMin
ûû '
=
ûû( )
s_Center
ûû* 2
;
ûû2 3
}
üü 	
private
•• 
Material
•• 
_unmaskMaterial
•• (
;
••( )
private
¶¶ 
Material
¶¶ #
_revertUnmaskMaterial
¶¶ .
;
¶¶. /
private
ßß 
MaskableGraphic
ßß 
_graphic
ßß  (
;
ßß( )
private
¨¨ 
void
¨¨ 
OnEnable
¨¨ 
(
¨¨ 
)
¨¨ 
{
≠≠ 	
if
ÆÆ 
(
ÆÆ 
m_FitTarget
ÆÆ 
)
ÆÆ 
{
ØØ 
FitTo
∞∞ 
(
∞∞ 
m_FitTarget
∞∞ !
)
∞∞! "
;
∞∞" #
}
±± 
SetDirty
≤≤ 
(
≤≤ 
)
≤≤ 
;
≤≤ 
}
≥≥ 	
private
∏∏ 
void
∏∏ 
	OnDisable
∏∏ 
(
∏∏ 
)
∏∏  
{
ππ 	
StencilMaterial
∫∫ 
.
∫∫ 
Remove
∫∫ "
(
∫∫" #
_unmaskMaterial
∫∫# 2
)
∫∫2 3
;
∫∫3 4
StencilMaterial
ªª 
.
ªª 
Remove
ªª "
(
ªª" ##
_revertUnmaskMaterial
ªª# 8
)
ªª8 9
;
ªª9 :
_unmaskMaterial
ºº 
=
ºº 
null
ºº "
;
ºº" ##
_revertUnmaskMaterial
ΩΩ !
=
ΩΩ" #
null
ΩΩ$ (
;
ΩΩ( )
if
øø 
(
øø 
graphic
øø 
)
øø 
{
¿¿ 
var
¡¡ 
canvasRenderer
¡¡ "
=
¡¡# $
graphic
¡¡% ,
.
¡¡, -
canvasRenderer
¡¡- ;
;
¡¡; <
canvasRenderer
¬¬ 
.
¬¬ 
hasPopInstruction
¬¬ 0
=
¬¬1 2
false
¬¬3 8
;
¬¬8 9
canvasRenderer
√√ 
.
√√ 
popMaterialCount
√√ /
=
√√0 1
$num
√√2 3
;
√√3 4
graphic
ƒƒ 
.
ƒƒ 
SetMaterialDirty
ƒƒ (
(
ƒƒ( )
)
ƒƒ) *
;
ƒƒ* +
}
≈≈ 
SetDirty
∆∆ 
(
∆∆ 
)
∆∆ 
;
∆∆ 
}
«« 	
private
ÃÃ 
void
ÃÃ 

LateUpdate
ÃÃ 
(
ÃÃ  
)
ÃÃ  !
{
ÕÕ 	
if
œœ 
(
œœ 
m_FitTarget
œœ 
&&
œœ 
(
œœ  
m_FitOnLateUpdate
œœ  1
||
œœ2 4
!
œœ5 6
Application
œœ6 A
.
œœA B
	isPlaying
œœB K
)
œœK L
)
œœL M
{
”” 
FitTo
‘‘ 
(
‘‘ 
m_FitTarget
‘‘ !
)
‘‘! "
;
‘‘" #
}
’’ 
	Smoothing
◊◊ 
(
◊◊ 
graphic
◊◊ 
,
◊◊ 
m_EdgeSmoothing
◊◊ .
)
◊◊. /
;
◊◊/ 0
}
ÿÿ 	
private
ﬁﬁ 
void
ﬁﬁ 

OnValidate
ﬁﬁ 
(
ﬁﬁ  
)
ﬁﬁ  !
{
ﬂﬂ 	
SetDirty
‡‡ 
(
‡‡ 
)
‡‡ 
;
‡‡ 
}
·· 	
void
ÁÁ 
SetDirty
ÁÁ 
(
ÁÁ 
)
ÁÁ 
{
ËË 	
if
ÈÈ 
(
ÈÈ 
graphic
ÈÈ 
)
ÈÈ 
{
ÍÍ 
graphic
ÎÎ 
.
ÎÎ 
SetMaterialDirty
ÎÎ (
(
ÎÎ( )
)
ÎÎ) *
;
ÎÎ* +
}
ÏÏ 
}
ÌÌ 	
private
ÔÔ 
static
ÔÔ 
void
ÔÔ 
	Smoothing
ÔÔ %
(
ÔÔ% &
MaskableGraphic
ÔÔ& 5
graphic
ÔÔ6 =
,
ÔÔ= >
float
ÔÔ? D
smooth
ÔÔE K
)
ÔÔK L
{
 	
if
ÒÒ 
(
ÒÒ 
!
ÒÒ 
graphic
ÒÒ 
)
ÒÒ 
return
ÒÒ  
;
ÒÒ  !
Profiler
ÛÛ 
.
ÛÛ 
BeginSample
ÛÛ  
(
ÛÛ  !
$str
ÛÛ! 5
)
ÛÛ5 6
;
ÛÛ6 7
var
ÙÙ 
canvasRenderer
ÙÙ 
=
ÙÙ  
graphic
ÙÙ! (
.
ÙÙ( )
canvasRenderer
ÙÙ) 7
;
ÙÙ7 8
var
ıı 
currentColor
ıı 
=
ıı 
canvasRenderer
ıı -
.
ıı- .
GetColor
ıı. 6
(
ıı6 7
)
ıı7 8
;
ıı8 9
var
ˆˆ 
targetAlpha
ˆˆ 
=
ˆˆ 
$num
ˆˆ  
;
ˆˆ  !
if
˜˜ 
(
˜˜ 
graphic
˜˜ 
.
˜˜ 
maskable
˜˜  
&&
˜˜! #
$num
˜˜$ %
<
˜˜& '
smooth
˜˜( .
)
˜˜. /
{
¯¯ 
var
˘˘ 
currentAlpha
˘˘  
=
˘˘! "
graphic
˘˘# *
.
˘˘* +
color
˘˘+ 0
.
˘˘0 1
a
˘˘1 2
*
˘˘3 4
canvasRenderer
˘˘5 C
.
˘˘C D
GetInheritedAlpha
˘˘D U
(
˘˘U V
)
˘˘V W
;
˘˘W X
if
˙˙ 
(
˙˙ 
$num
˙˙ 
<
˙˙ 
currentAlpha
˙˙ $
)
˙˙$ %
{
˚˚ 
targetAlpha
¸¸ 
=
¸¸  !
Mathf
¸¸" '
.
¸¸' (
Lerp
¸¸( ,
(
¸¸, -
$num
¸¸- 2
,
¸¸2 3
$num
¸¸4 :
,
¸¸: ;
smooth
¸¸< B
)
¸¸B C
/
¸¸D E
currentAlpha
¸¸F R
;
¸¸R S
}
˝˝ 
}
˛˛ 
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
Mathf
ÄÄ 
.
ÄÄ 
Approximately
ÄÄ $
(
ÄÄ$ %
currentColor
ÄÄ% 1
.
ÄÄ1 2
a
ÄÄ2 3
,
ÄÄ3 4
targetAlpha
ÄÄ5 @
)
ÄÄ@ A
)
ÄÄA B
{
ÅÅ 
currentColor
ÇÇ 
.
ÇÇ 
a
ÇÇ 
=
ÇÇ  
Mathf
ÇÇ! &
.
ÇÇ& '
Clamp01
ÇÇ' .
(
ÇÇ. /
targetAlpha
ÇÇ/ :
)
ÇÇ: ;
;
ÇÇ; <
canvasRenderer
ÉÉ 
.
ÉÉ 
SetColor
ÉÉ '
(
ÉÉ' (
currentColor
ÉÉ( 4
)
ÉÉ4 5
;
ÉÉ5 6
}
ÑÑ 
Profiler
ÜÜ 
.
ÜÜ 
	EndSample
ÜÜ 
(
ÜÜ 
)
ÜÜ  
;
ÜÜ  !
}
áá 	
}
àà 
}ââ 